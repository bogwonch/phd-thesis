\documentclass[thesis.tex]{subfiles}
\begin{document}
\chapter{Mobile Ecosystems}

\section{Android and its Ecosystem}\label{android-and-its-ecosystem}

Android is a mobile operating system developed, primarily, by Google. It
is by far the most popular mobile operating system in use being
installed on around 83\% of all mobile handsets\footnote{\url{http://www.idc.com/prodserv/smartphone-os-market-share.jsp}}
with Apple's iOS being its only major competitor (Windows Phone,
Blackberry OS and other mobile operating systems account for only 3\% of
the marketshare in 2015).

Despite the dominance of Android its ecosystem is rather fragmented. As
shown in Figure \url{fig:android-versions}, in June 2016 only 10\% of
devices used the latest version of Android, with around 5\% of devices
still using a version released five years prior. The range of different
Android versions is often blamed on the device manufacturers being
unwilling to update their devices. Since the core of Android is open
source this has lead to third parties (such as CyanogenMod\footnote{\url{http://www.cyanogenmod.org}})
have started developing custom firmware for Android devices to allow
older devices to be upgraded independently of their manufacturers.

\begin{figure*}[htbp]
\centering
\includegraphics[width=\linewidth]{chapters/02-mobile-ecosystems/figures/android-versions.eps}
\caption{Historical Android version's distribution. Figure by
\emph{Erikrespo} taken from
\url{https://en.wikipedia.org/wiki/Android_version_history}.}
\end{figure*}

When building an Android device the manufacturers are also able to make
modifications to the Android firmware. This can be done to support any
custom hardware their device may have, add any additional software or
apps, or provide a custom look or theme to their device. Again this
creates more variety in the ecosystem, with few guarantees that any two
devices may contain similar features or hardware. In fact since the core
of the Android is the Linux kernel (albeit without the Linux Standard
Base\footnote{The \emph{Linux Standard Base} is a specification produced
  by the Linux foundation that describes what a stardard Linux system
  should contain and how it should be organised. Android uses its own
  system which differs most noticably by the different filesystem
  structures and the use of user IDs to separate apps rather than users.
  \url{http://refspecs.linuxfoundation.org/lsb.shtml}}, and with
additional patches) it can be ported to other architectures (such as X86
and MIPS), and used in other devices (such as set-top boxes and TVs,
watches, and cars) with relative ease.

To give developers a somewhat stable base to develop for Google
developed the \emph{Compatibility Test Suite} (CTS)\footnote{\url{https://source.android.com/compatibility/cts/index.html}},
and \emph{Compatibility Definition Document} (CDD)\footnote{\url{https://source.android.com/compatibility/android-cdd.html}}.
The CTS is a series of unit tests that check basic Android functionality
and behavior. The CDD is a document that describes what hardware an
Android device should have and how the device and it's software should
be built. If a device manufacturer wishes their device to run Google's
Play Store (the largest Android app marketplace), then they are required
to show they can pass the CTS and are in compliance with the CDD.

\subsection{Android Market Places}\label{android-market-places}

The Play Store is Google's marketplace for apps. It contains a large
number of apps (around 2.2 million) uploaded by developers for users to
buy. To use the market places user's can login with a Google account
which is then used to sync purchases to their devices. Developers pay a
small fee (currently \$25) to submit an app to the store.

Google publish guidelines for developers wanting to publish
apps\footnote{\url{https://play.google.com/about/developer-content-policy/}}.
These guidelines describe what content is acceptable, how developers may
publicise their app and request feedback as well as what kinds of
advertising is acceptable. Apps are inspected by Google before
publication; a somewhat secretive process that includes static analysis
as well as dynamic analysis using their \emph{Bouncer} tool
\cite{oberheide_dissecting_2012}.

Whilst the Play store may be the \emph{official} Android app marketplace
it is not the only way to install apps. Apps can be sideloaded
(installed) by asking the operating system to install the APK file (the
file format of an Android app) directly. Alternatively a third-party
store can be installed which will allow users to buy and sideload apps.

These third-party stores exist for a variety of reasons. Some such as
\emph{Qihoo 360 Mobile Assistant} and \emph{Baidu App Store} exist to
cater to the Chinese market, which has not traditionally had access to
Google's services for political reasons. Others such as the /Amazon
Appstore/\footnote{The Amazon app store is also available to all
  devices, and aims to be similar to the Google Play store, but with a
  more stringent review process.}, \emph{Sony Xperia Apps} or
\emph{Samsung Galaxy Apps} exist as curated app stores featuring apps
highlighting a particular device's features. There are app stores for
open source apps like \emph{F-Droid}. There are app stores for devices
that can't (or don't want to) pass the CTS and CDD like \emph{Yandex}
and \emph{Aptoide}.

Each store comes with its own terms and conditions, some of which are
summarised in Table \url{tab:store-summary}. A user who does not wish to
be given updates might wish to use the Amazon store as it does not force
them to be installed. A developer who wishes to sell pornographic apps,
might want to use Yandex's store as many others prohibit them.

The only way to distinguish between these app stores is by
careful consideration of their advertising and terms and conditions.

\begin{table*}\footnotesize
  \begin{tabulary}{\linewidth}{lLLLL}
    \toprule
    & Google Play & Amazon & Yandex & Aptoide\\
    \midrule
    User ID & Name address and billing details. & Amazon ID. & None for free
    apps, payment details for paid. & Contact details. No verification but
    agreement not to lie.\\
    Client info taken & Installation data, device ID, browsing history,
    cookies. Can opt out. & Device ID, network info, location, usage data. &
    Device ID, SIM number, Device content, System data, browsing history. &
    Transaction history. They may share it with developers.\\
    Customer Payments & Google Wallet and others at Google's discretion. &
    Amazon. & Approved processor by Yandex or store operator. & Approved
    processor by Aptoide.\\
    Who is paid? & Google Commerce. & Amazon. & Developer. & Store
    owner.\\
    Prices set by & Developer. & Amazon. & Developer (but Yandex may
    restrict to set values). & Developer and store owner.\\
    Refunds & Only for defective or removed content. A refund may be
    requested for two hours after purchase. & No. & Up to 15 minutes after
    purchase. No for IAP. & Up to 24 hours after purchase.\\
    Age of use & At least 13. & Any age (with consent of guardian). No
    alcohol related content below 21. & At least 14. & A legal age to form a
    contract with Aptoide.\\
    Update provision & You agree to receive updates. & By default. & Yes for
    security and bug-fixes. & Yes agree to receive updates.\\
    Moderation & No obligation (but they may). & Publisher obliged to
    provide info which may be used to give ratings. Amazon will not check
    these ratings are accurate. & No obligation (but they may). & No
    obligation (but they may). Trusted app mark does not indicate
    moderation.\\
    Acceptable use & No use as part of a public performance, or for
    dangerous activities where failure may lead to death. & & & No
    modification, rental, distribution or derivative works. You may use the
    software.\\
    Store rights to app & Marketing and optimising Android. & Distribution,
    evaluation, modification, advertising, and creating derivatives for
    promotion. & Advertising. & Modification and re-selling.\\
    Withdrawal from sale & Immediate. & 10 days, or 5 days if for copy-write
    reasons. & 90 days. A copy will be retained. & You may.\\
    Developer ID & Google account and billing details. & Amazon ID. & Email,
    company name, tax-id. & Email (preferably a Google developer
    one).\\
    EULA & Default offered. & Only if it doesn't interfere with Amazon's
    terms. & Must be provided. & Default offered\\
    Content restrictions & No alternate stores, sexual, violence, IP
    infringing, PII publishing, illegal, gambling, malware, self-modifying
    or system modifying content. No unpredictable network use. & No
    offensive, pornography, illegal, IP infringing or gambling content. & No
    defects. No illegal, disruptive, sexual, IP infringing, PII stealing,
    alternative stores, or open-source content. & No displaying or linking
    to illegal, privacy interfering, violent, PII stealing, IP infringing
    content. Nothing \emph{spammy} or with unpredictable network
    use.\\
    Payout rates & 70\% of the user's payment. & 70\% list price (minus card
    fees). & 70\% net-revenue (minus card fees). & 75\% revenue share (minus
    card fees).\\
    \bottomrule
  \end{tabulary}
  \label{tab:store-tandcs}
  \caption{Summary of conditions in different stores.}
\end{table*}

\section{Policies and users}

For a user finding the right apps can be tricky.
Users need to discover which are not going to abuse their data.
This can be difficult as it isn't obvious how apps use the data each has access to.
Consider a user attempting to buy a flashlight app.
By searching the Play store the user is presented with a long list of apps.
Clicking through each one they can find the permissions each requests but not the reasons why each was needed.
They can see review scores from users but not from tools to check apps for problems and issues like SSL misconfigurations~\cite{fahl_why_2012}.
If they want to use the app at work will it break their employers rules for mobile usage?

App stores give some information about their apps; descriptions, screenshots and review scores.
Android apps show a list of permissions when they're first installed.
In Android Marshmallow apps will display permissions requests when the app first tries to access sensitive data (such as contacts or location information).
Users do not understand how permissions relate to their device~\cite{felt_android_2012,thompson_when_2013}.
Ultimately the decision of which apps to use and which permissions to grant must be made by the device user.

Some apps are highly undesirable.
Many \acp{PUP} are being propagated for Android devices~\cite{truong_company_2014,vanja_svajcer_classifying_2013}.
Employees are increasingly using their own phones for work.
An employer may restrict which apps their employees can use.
The IT department may set a mobile device policy---a series of rules describing what kinds of apps may be used and how---to prevent information leaks.
Some users worry that apps will misuse their personal data---sending their address book or location to an advertiser without their permission.
Such a user avoids apps which can access their location, or address book; they may apply their own personal security policies when downloading and running apps.

\begin{marginfigure}
\newcommand{\tabtitle}[1]{\textbf{\footnotesize #1}}
\footnotesize
\begin{center}
  \begin{tabular}{ r l l l l }
%                                     & \rothead{Conservative} & \rothead{Advanced} & \rothead{Fencesitter} & \rothead{Unconcerned} \\
    \toprule
    \tabtitle{Policy}                 & \tabtitle{C}           & \tabtitle{A}       & \tabtitle{F}          & \tabtitle{U}          \\
    \midrule
    \texttt{GET\_ACCOUNTS}            & \xmark                 & \xmark             & \xmark                & \xmark                \\
    \texttt{ACCESS\_FINE\_LOCATION}   & \xmark                 & \xmark             & \xmark                &                       \\
    \texttt{READ\_CONTACT}            & \xmark                 & \xmark             & \xmark                &                       \\
    \texttt{READ\_PHONE\_STATE}       & \xmark                 & \xmark             &                       &                       \\
    \texttt{SEND\_SMS}                & \xmark                 & \xmark             &                       &                       \\
    \texttt{ACCESS\_COARSE\_LOCATION} & \xmark                 &                    &                       &                       \\
    \bottomrule
  \end{tabular}
  \label{tab:lin_perms}
  \caption{Policies identified by Lin~\etal expressed as sets of prohibited permissions.}
\end{center}
\end{marginfigure}

Users can have internalized policies that govern which apps they chose.
In a study of 725 Android users, Lin~\etal~found four patterns that characterise user privacy preferences for apps~\cite{lin_modeling_2014} demonstrating a refinement of Westin's privacy segmentation index~\cite{harris_interactive_privacy_2002}.
Lin~\etal~identified four types of user.
The \emph{Conservative} (C) users were uncomfortable allowing an app access to any personal data for any reason.
The \emph{Unconcerned} (U) users felt okay allowing access to most data for almost any reason.
The \emph{Advanced} (A) users were comfortable allowing apps access to location data but not if it was for advertising.
Opinions in the largest cluster, \emph{Fencesitters} (F), varied but were broadly against collection of personal data for advertising.
I wrote AppPAL policies to describe each of these behaviours as sets of prohibited permissions, shown in \autoref{tab:lin_perms}.
These simplify the privacy policies identified by Lin~\etal~as I do not take into account the reason each app might have been collecting each permission
(I could write more precise rules if I could determine why each permission was requested).
Lin~\etal~used Androguard~\cite{andrew_desnos_androguard_????} as well as manual analysis to determine the precise reasons for each permission~\cite{lin_modeling_2014}.

To test the extent users were following the policies I took installation from a partially anonymized database of installed apps captured by Carat~\cite{oliner_carat:_2013}.
By calculating the hashes of known package names, mostly taken from the Android Observatory, I could discover who had installed certain apps.
The initial database has over 90,000 apps and 55,000 users.
On average each Carat user installed around 90 apps each; 4,300 apps have known names.
Disregarding system apps (such as \texttt{com.android.vending}) and very common apps (Facebook, Dropbox, Whatsapp, and Twitter) I reduced the set to an average of 20 known apps per user.
To see some variation in app type, I considered only the 44,000 users who had more than 20 known apps.
Using this data, and the apps themselves taken from the Google Play Store and Android Observatory~\cite{barrera_understanding_2012}, I checked which apps satisfied which policies.

\begin{figure*}
  \centering
  \subfloat[Advanced policy]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/lin_a.eps} 
  }
  \subfloat[Conservative policy]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/lin_c.eps} 
  }\\
  \subfloat[Fencesitter policy]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/lin_f.eps} 
  }
  \subfloat[Unconcerned policy]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/lin_u.eps} 
  }\\
  \vspace{2em}
  \caption[Adoption of Lin~\etal~policies.]{Adoption of the four Lin~\etal~policies amongst users from the Carat dataset.  The vast majority of users do not appear to be following these policies most of the time.}
  \label{fig:lin_uptake_graphs}
\end{figure*}

The charts shown in \autoref{fig:lin_uptake_graphs} show that very few users seem to follow Lin~\etal's policies most of the time~\cite{hallett_apppal_2016}.  Even for the least onourus unconcerned policy most users did not seem to follow the policy most of the time.
This suggests that there is a disconnect between user's privacy preferences and their behavior (reminiscent of the \emph{privacy paradox}\footnote{The privacy paradox is that whilst people will say they are very concerned about their privacy, they do not alter their behaviour in order to protect it.  It was first noticed by psychologists looking at how people use social network; though has appeared in many other areas since.}); assuming the user population studied by Lin~\etal~was similar to the data in the Carat study.

A few users, however, did seem to be installing apps meeting these policies most of the time.
This suggests that while users may have privacy preferences the majority are not attempting to enforce them.
Policy enforcement tools, like AppPAL, can help users enforce their own policies which they cannot do easily using the current ad hoc, manual means available to them.

It is also interesting to discover when people install apps classified as malware.
McAfee classify malware into several categories, and provided us with a dataset of apps classified as malware and \acp{PUP}.
The \emph{malicious} and \emph{trojan} categories describe traditional malware.
Other categories classify \ac{PUP} such as aggressive adware.
Using AppPAL I can write policies to differentiate characterising users who allow dangerous apps and those who install poor quality ones.
\begin{lstlisting}
'user' says 'mcafee' can-say
  'malware' isKindOf(App).
'mcafee' says 'trojan' can-act-as 'malware'.
'mcafee' says 'pup' can-act-as 'malware'.
\end{lstlisting}
If a user is enforcing a privacy policy we might also expect them to install less malware.
We can check this by using AppPAL policies to measure the number of malwares each user had installed.

\begin{marginfigure}
  \centering
  \subfloat[Malware only]{%
    \includegraphics[width=\linewidth]{chapters/02-mobile-ecosystems/figures/malware_np.eps}
  }\\
  \subfloat[Malware and PUPs]{%
    \includegraphics[width=\linewidth]{chapters/02-mobile-ecosystems/figures/malware_nm.eps}
  }\\
  \caption{Malware installation numbers in the Carat dataset.}
  \label{fig:malware}
\end{marginfigure}
I found that 1\% of the users had a \ac{PUP} or malicious app installed.
Figure~\ref{fig:malware} shows that infection rates for \acp{PUP} and malware is low;
though a user is 3 times more likely to have a \ac{PUP} installed than malware.
It is interesting to compare a user's compliance to the Lin~\etal~policies with the amount of malware each had installed (Figure \autoref{fig:lin_malware_graphs}).
Users who were complying more than half the time with the conservative or advanced policies complied with the malware or \ac{PUP} policies fully.
This suggests that policy enforcement is worthwhile: users who do enforce policies about their apps experience less malware.
This could also be attributed to the users needing to be more selective about their apps in order to enforce their policy: a careful user is unlikely to install malware generally.

\begin{figure*}
  \centering
  \subfloat[Advanced policy and malware]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/advanced-v-pup.eps} 
  }
  \subfloat[Conservative policy and malware]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/conservative-v-pup.eps}
  }\\
  \subfloat[Fencesitter policy and malware]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/fencesitter-v-pup.eps}
  }
  \subfloat[Unconcerned policy and malware]{%
    \includegraphics[width=0.5\linewidth]{chapters/02-mobile-ecosystems/figures/unconcerned-v-pup.eps}
  }\\
  \vspace{2em}
  \caption[Plots of compliance with the Lin policies versus malware installation.]{Graphs plotting a users conformance with the Lin~\etal~policies against the amount of malware they had installed on their device.  Each dot represents a user.}
  \label{fig:lin_malware_graphs}
\end{figure*}


\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../thesis"
%%% End:
